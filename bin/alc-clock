#!/bin/env sh

file=~/.local/state/al/clock

explain_usage() {
  alm-clock --help
}

interactive() {
  date +%H:%M
  hour="$(date +%H)"
  print='printf("%4d:%s\n", NR, $0)'
  from="NR >= $((hour - 1))"
  up_to="NR <= $((hour + 1))"
  awk "$from && $up_to {$print}" "$file"
}

run() {
  INTERACTIVE="${INTERACTIVE:-$(tty -s && echo yes || echo no)}"
  if [ "$INTERACTIVE" = yes ]
  then interactive
  else alm-clock "$@" < "$file"
  fi
}

case "$1" in
  -h | --help) explain_usage ;;
  *) run "$@" ;;
esac


